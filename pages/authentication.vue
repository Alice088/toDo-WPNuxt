<script setup lang="ts">
const theme =  useThemeStore();
const randomQuote = await useFetchRandomQuote();
const userAccount = useUserAccountStore();
const router = useRouter();

const sendButtonText = ref("send");
const disabledFormButton = ref(false);

const password = ref("");
const nickname = ref("");

async function sendDataToServer() {
	const isValidPassword = isValidData(password.value, 20, 10, "password").result;
	const isValidNickname = isValidData(password.value, 20, 10, "nickname").result;
	
	if(isValidPassword && isValidNickname) {
		userAccount.fetchingServer = true;
		disabledFormButton.value = true;

		await userAccount.authenticationUser(nickname.value, password.value)
			.then(() => {
				userAccount.fetchingServer = false;
				router.push({path: "/home"});
			})
			.catch(err  => {
				userAccount.fetchingServer = false;
				
				sendButtonText.value = `${err.data.data.message ?? "Something went wrong!"}: ${err.status},`;

				setTimeout(() => sendButtonText.value = "send", 5000);
			});

		setTimeout(() => disabledFormButton.value = false, 5000);
		userAccount.fetchingServer = false;
	}
}

onMounted(theme.detectAndSetTheme);
</script>

<template>
	<main class="registration">
		<form class="form" onclick="return false">
			<svg xmlns="http://www.w3.org/2000/svg" width="250" height="150" viewBox="0 0 2000 1000">
				<path d="" stroke="#FFDAD8" fill="#080404"/>
				<path d="M 538 25.438 C 538 28.812, 538.177 29, 541.352 29 C 547.869 29, 554.865 36.068, 558.674 46.500 C 560.413 51.261, 560.512 60.069, 560.761 230.934 C 560.989 388.101, 560.835 411.097, 559.515 416.249 C 556.532 427.891, 548.158 438, 541.497 438 C 538.157 438, 538 438.160, 538 441.553 L 538 445.106 611.750 444.742 C 692.613 444.342, 692.616 444.341, 719 437.877 C 762.339 427.258, 803.381 402.184, 830.699 369.637 C 858.499 336.515, 874.542 295.886, 877.966 249.927 C 881.118 207.624, 871.049 163.262, 849.790 125.792 C 822.626 77.913, 775.819 42.507, 721.945 29.087 C 696.187 22.671, 697.622 22.762, 614.250 22.299 L 538 21.876 538 25.438 M 605 233.600 L 605 422.200 634.250 421.732 C 666.571 421.214, 675.245 420.215, 697.953 414.399 C 764.082 397.463, 813.740 350.774, 828.936 291.248 C 836.528 261.512, 835.416 219.343, 826.201 187.500 C 810.073 131.766, 773.472 88.669, 721 63.625 C 692.103 49.833, 667.423 45, 625.894 45 L 605 45 605 233.600 M 61.500 68.563 C 50.500 72.124, 36.438 76.629, 30.250 78.574 L 19 82.111 19 85.468 C 19 88.639, 19.235 88.863, 23.250 89.532 C 39.748 92.279, 40.957 95.975, 40.983 143.750 L 41 176 23 176 L 5 176 5 187 L 5 198 22.919 198 L 40.839 198 41.248 290.750 C 41.698 392.759, 41.702 392.824, 48.035 410.232 C 54.499 428.004, 67.657 439.912, 84.856 443.557 C 93.266 445.340, 114.720 445.388, 122.142 443.641 C 128.484 442.148, 136.157 438.088, 145.148 431.470 C 148.487 429.012, 152.296 427, 153.610 427 L 156 427 156 402.937 L 156 378.873 152.874 379.187 C 149.915 379.483, 149.609 379.928, 147.124 387.554 C 143.714 398.020, 138.855 405.948, 131.876 412.435 C 115.846 427.332, 97.040 426.144, 90.005 409.791 C 84.799 397.689, 84.749 396.664, 84.287 293.750 L 83.858 198 119.929 198 L 156 198 156 187 L 156 176 120 176 L 84 176 84 119 C 84 74.043, 83.736 62.009, 82.750 62.045 C 82.063 62.069, 72.500 65.003, 61.500 68.563 M 323 172.034 C 288.810 176.227, 259.965 189.855, 237.485 212.439 C 218.111 231.903, 205.934 255.508, 200.312 284.500 C 197.636 298.301, 197.909 329.073, 200.828 342.688 C 209.845 384.742, 233.841 416.369, 270.797 434.907 C 313.284 456.221, 372.497 454.683, 412.622 431.225 C 448.160 410.448, 470.662 378.176, 479.209 335.728 C 482.417 319.794, 482.399 291.259, 479.172 276.266 C 473.334 249.146, 460.753 226.396, 441.528 208.198 C 422.862 190.529, 400.391 179.265, 373.265 173.981 C 360.896 171.571, 334.966 170.567, 323 172.034 M 1053.500 171.945 C 1004.671 177.624, 965.257 203.625, 944.076 244.128 C 933.996 263.404, 929.225 281.987, 928.311 305.535 C 927.223 333.560, 931.632 355.241, 943.049 378 C 958.061 407.929, 983.857 430.142, 1017.200 441.853 C 1049.260 453.113, 1093.429 452.343, 1124.548 439.981 C 1148.291 430.549, 1170.999 412.860, 1185.452 392.539 C 1211.639 355.718, 1219.068 301.688, 1203.908 258.312 C 1188.390 213.912, 1149.722 182.060, 1101 173.544 C 1090.075 171.634, 1063.780 170.749, 1053.500 171.945 M 319.051 195.054 C 278.832 203.797, 250.385 236.295, 242.505 282.500 C 240.373 295.002, 240.330 317.278, 242.415 329.013 C 248.440 362.919, 264.662 391.293, 288.132 408.978 C 303.641 420.665, 319.875 426.629, 339.075 427.694 C 361.949 428.964, 379.805 423.589, 397.824 410.012 C 411.100 400.008, 419.804 388.947, 428.151 371.474 C 437.797 351.280, 442.434 324.214, 440.185 301.232 C 437.015 268.835, 424.998 241.664, 405.120 221.951 C 386.476 203.461, 365.944 194.476, 340 193.453 C 330.862 193.093, 326.560 193.421, 319.051 195.054 M 1050.834 194.496 C 995.240 205.069, 961.202 264.352, 972.596 330.759 C 979.610 371.635, 1005.597 407.238, 1038.381 420.886 C 1051.395 426.304, 1057.826 427.442, 1075 427.368 C 1088.854 427.307, 1091.456 427.013, 1099.500 424.592 C 1142.205 411.743, 1170.310 367.854, 1170.319 314 C 1170.326 276.945, 1158.088 244.984, 1135.064 221.924 C 1122.260 209.100, 1106.374 199.988, 1089.893 196.015 C 1078.621 193.298, 1060.782 192.604, 1050.834 194.496 M 209 644.992 C 181.225 730.716, 158.212 800.549, 157.860 800.177 C 157.509 799.805, 138.456 738.300, 115.522 663.500 C 75.375 532.559, 73.840 527.258, 74.262 521 C 75.008 509.941, 81.061 501.676, 89.407 500.321 C 92.705 499.786, 93 499.461, 93 496.369 L 93 493 47 493 L 1 493 1 496.372 C 1 499.495, 1.278 499.789, 4.750 500.351 C 12.483 501.601, 20.745 510.391, 26.573 523.568 C 27.891 526.549, 55.544 616.177, 88.025 722.743 C 120.506 829.310, 147.318 917.175, 147.608 918 C 148.076 919.333, 148.225 919.333, 148.945 918 C 149.391 917.175, 171.647 847.200, 198.403 762.500 C 225.159 677.800, 247.376 607.710, 247.775 606.745 C 248.247 605.602, 265.537 658.754, 297.380 759.245 C 324.265 844.085, 346.777 914.801, 347.409 916.390 C 348.450 919.012, 354.075 901.074, 407.930 723.390 C 440.586 615.651, 468.313 525.470, 469.547 522.990 C 476.285 509.444, 487.624 500.036, 497.250 500.006 C 498.582 500.001, 499 499.165, 499 496.500 L 499 493 464 493 L 429 493 429 496.392 C 429 499.147, 429.455 499.897, 431.423 500.391 C 435.142 501.325, 440.084 505.975, 442.120 510.459 C 444.163 514.956, 444.438 520.245, 442.980 527 C 441.612 533.337, 358.610 799.963, 358 799.978 C 357.725 799.985, 335.736 730.356, 309.137 645.246 C 282.537 560.135, 260.487 490.192, 260.137 489.815 C 259.786 489.438, 236.775 559.268, 209 644.992 M 536 496.500 C 536 499.542, 536.319 500, 538.435 500 C 545.580 500, 550.781 504.619, 555.224 514.912 L 558.500 522.500 558.765 701.500 C 558.950 826.696, 558.705 882.069, 557.950 885.719 C 556.438 893.032, 551.436 902.565, 547.422 905.783 C 545.558 907.277, 542.338 908.725, 540.267 909 C 536.871 909.451, 536.469 909.820, 536.187 912.750 L 535.873 916 581.437 916 L 627 916 627 912.500 C 627 909.167, 626.833 909, 623.503 909 C 616.693 909, 607.636 897.282, 605.109 885.201 C 604.348 881.564, 604 853.449, 604 795.566 L 604 711.229 627.750 710.724 C 648.250 710.287, 653.151 709.865, 663.569 707.638 C 696.073 700.691, 723.471 686.815, 742.584 667.622 C 766.051 644.058, 775.428 618.252, 772.213 586.088 C 767.469 538.649, 736.526 508.724, 680.650 497.539 C 661.137 493.633, 648.729 493.007, 590.750 493.003 L 536 493 536 496.500 M 825 496.486 C 825 499.841, 825.159 500, 828.532 500 C 837.066 500, 844.668 506.947, 848.024 517.814 C 849.961 524.083, 850 527.761, 850 702.554 L 850 880.897 847.507 888.789 C 843.511 901.438, 836.690 908.988, 829.250 908.996 C 826.203 909, 826 909.219, 826 912.500 L 826 916 862 916 L 898 916 898 912.500 C 898 909.056, 897.932 909, 893.807 909 C 890.051 909, 889.073 908.442, 884.437 903.655 C 881.170 900.283, 878.382 896.132, 876.880 892.405 L 874.500 886.500 874.255 718.500 L 874.010 550.500 876.921 555 C 879.636 559.198, 1029.792 797.333, 1081.367 879.236 L 1104.500 915.972 1124.735 915.986 L 1144.971 916 1145.235 720.250 C 1145.530 502.033, 1144.891 520.762, 1152.429 509.409 C 1156.634 503.076, 1159.789 500.796, 1165.380 500.050 C 1169.162 499.545, 1169.526 499.234, 1169.813 496.250 L 1170.127 493 1133.563 493 L 1097 493 1097 496.370 C 1097 499.632, 1097.147 499.756, 1101.593 500.258 C 1109.562 501.156, 1117.056 510.441, 1120.508 523.693 C 1121.801 528.657, 1122 551.326, 1122 693.859 L 1122 858.298 1006.243 675.899 L 890.486 493.500 857.743 493.236 L 825 492.973 825 496.486 M 604 601.973 L 604 688.252 624.250 687.715 C 646.974 687.112, 656.405 685.538, 671.616 679.811 C 686.679 674.140, 695.379 668.621, 706 658 C 716.620 647.380, 721.683 639.559, 725.747 627.500 C 728.213 620.183, 728.438 618.220, 728.393 604.500 C 728.352 592.305, 727.935 588.004, 726.161 581.500 C 719.671 557.699, 705.762 540.912, 683.500 530.012 C 665.320 521.110, 647.877 517.301, 620.750 516.308 L 604 515.695 604 601.973 M 1913.500 536.523 C 1908 538.374, 1894.162 542.869, 1882.750 546.511 L 1862 553.133 1862 556.437 C 1862 559.681, 1862.108 559.761, 1868.089 560.938 C 1872.496 561.805, 1875.132 563.014, 1877.635 565.318 C 1882.979 570.235, 1883.923 577.754, 1883.965 615.750 L 1884 647 1866 647 L 1848 647 1848 658 L 1848 669 1866 669 L 1884 669 1884.029 753.250 C 1884.045 799.587, 1884.478 843.236, 1884.991 850.247 C 1886.775 874.630, 1892.247 889.998, 1903.052 900.972 C 1914.605 912.706, 1927.119 916.572, 1950.868 915.746 C 1966.886 915.189, 1970.692 914.065, 1981.693 906.645 C 1985.888 903.815, 1990.486 900.715, 1991.910 899.755 C 1993.335 898.796, 1995.513 898.008, 1996.750 898.005 L 1999 898 1999 874 L 1999 850 1995.672 850 C 1992.477 850, 1992.295 850.211, 1991.133 855.250 C 1987.999 868.845, 1977.091 884.008, 1966.314 889.752 C 1952.402 897.167, 1939.673 894.182, 1933.533 882.064 C 1927.657 870.468, 1927.701 871.293, 1927.270 765.750 L 1926.875 669 1962.937 669 L 1999 669 1999 658 L 1999 647 1963 647 L 1927 647 1927 590 C 1927 536.351, 1926.897 533.005, 1925.250 533.079 C 1924.287 533.122, 1919 534.672, 1913.500 536.523 M 1263 650.010 L 1232.500 659.812 1232.190 663.406 C 1231.887 666.905, 1231.972 667, 1235.375 667 C 1240.023 667, 1243.880 668.547, 1247.373 671.814 C 1253.675 677.706, 1253.444 675.075, 1254.084 748 C 1254.562 802.545, 1254.973 816.747, 1256.365 827 C 1261.861 867.462, 1276.954 892.549, 1305.951 909.420 C 1321.206 918.295, 1342.722 922.590, 1367.500 921.707 C 1384.732 921.093, 1391.887 919.548, 1403.500 913.938 C 1412.837 909.426, 1427.219 898.026, 1434.734 889.179 L 1440 882.978 1440 899.489 L 1440 916 1471.500 916 L 1503 916 1503 912.625 C 1503 909.653, 1502.631 909.176, 1499.907 908.631 C 1496.181 907.886, 1491.352 902.984, 1488.882 897.437 C 1483.855 886.152, 1484 890.208, 1484 760.790 C 1484 664.134, 1483.748 640, 1482.736 640 C 1482.042 640, 1473.829 642.427, 1464.486 645.394 C 1455.144 648.360, 1440.836 652.892, 1432.692 655.465 L 1417.884 660.142 1418.192 663.321 C 1418.479 666.279, 1418.812 666.538, 1423 667.052 C 1431.523 668.098, 1436.571 672.358, 1438.936 680.500 C 1439.787 683.429, 1440.018 705.656, 1439.799 763.500 L 1439.500 842.500 1436.855 848.779 C 1429.020 867.375, 1414.641 882.632, 1396.500 891.597 C 1379.770 899.866, 1357.145 899.585, 1339.623 890.892 C 1315.278 878.813, 1301.540 856.028, 1298.040 821.924 C 1297.407 815.751, 1297 778.204, 1297 725.894 C 1297 644.717, 1296.904 640.006, 1295.250 640.104 C 1294.287 640.161, 1279.775 644.619, 1263 650.010 M 1547.187 650.215 C 1547.448 652.899, 1548.005 653.532, 1550.560 654.049 C 1558.664 655.692, 1569.750 663.826, 1579.400 675.210 C 1583.552 680.109, 1624.908 735.782, 1653.212 774.576 L 1656.915 779.652 1618.006 832.576 C 1576.207 889.429, 1566.906 900.500, 1556.812 905.408 C 1553.684 906.929, 1549.297 908.419, 1547.062 908.718 C 1543.224 909.233, 1543 909.449, 1543 912.632 L 1543 916 1573.500 916 L 1604 916 1604 912.500 C 1604 909.710, 1603.609 909, 1602.071 909 C 1599.330 909, 1596.997 906.312, 1597.018 903.179 C 1597.049 898.583, 1601.599 891.826, 1636.377 844.727 C 1670.130 799.015, 1670.178 798.957, 1671.938 801.227 C 1680.906 812.795, 1737.842 892.438, 1739.688 895.997 C 1741.561 899.607, 1741.884 901.176, 1741.150 903.106 C 1739.846 906.535, 1737.532 908.229, 1733.198 908.927 C 1729.908 909.457, 1729.465 909.880, 1729.187 912.761 L 1728.873 916 1776.437 916 L 1824 916 1824 912.500 C 1824 909.314, 1823.743 909, 1821.134 909 C 1819.558 909, 1815.067 907.398, 1811.155 905.441 C 1797.401 898.560, 1792.135 892.426, 1743.197 826.273 C 1718.613 793.043, 1698.553 765.267, 1698.619 764.550 C 1698.826 762.270, 1765.712 674.472, 1773.773 665.900 C 1781.553 657.626, 1787.095 654.063, 1792.250 654.022 C 1794.722 654.002, 1795 653.646, 1795 650.500 L 1795 647 1764 647 L 1733 647 1733 650.500 C 1733 653.235, 1733.403 654, 1734.845 654 C 1739.370 654, 1742.412 660.979, 1740.920 667.936 C 1740.031 672.082, 1735.767 678.268, 1712.850 708.662 C 1697.988 728.373, 1685.463 744.500, 1685.017 744.500 C 1684.571 744.500, 1672.009 727.639, 1657.103 707.031 C 1631.535 671.685, 1630 669.316, 1630 665.215 C 1630 662.825, 1630.463 660.003, 1631.030 658.945 C 1632.249 656.666, 1637.059 654, 1639.950 654 C 1641.626 654, 1642 653.362, 1642 650.500 L 1642 647 1594.437 647 L 1546.873 647 1547.187 650.215"
				      stroke="none" :fill="theme.theme === 'Dark' ? '#F0C9C4' : '#3B3738'" fill-rule="evenodd"/>
			</svg>

			<div class="form__inputBox">
				<theInput class="form__input"
				          type="text"
				          placeholder="nickname"
				          :model-value="nickname"
				          maxLength="20"
				          @update:model-value="newValue => nickname = newValue" />

				<theInput class="form__input"
				          placeholder="password"
				          type="password"
				          v-model="password"
				          maxLength="20"
				          @update:model-value="newValue => password = newValue"/>

				<TheButton class="form__button" :disabled="disabledFormButton">
					<p @click="disabledFormButton ? null : sendDataToServer()" v-if="!userAccount.fetchingServer">
						{{ sendButtonText }}
					</p>

					<TheLoadingSpinner v-else :size="45" :rounded="5" />
				</TheButton>
			</div>

			<div class="form__description">
				<p> Authentication </p>

				<NuxtLink to="/"> Don't have account? </NuxtLink>
			</div>
		</form>

		<section class="quotesBox">
			<blockquote class="quotesBox__quote">
				<q>{{ randomQuote.content }}</q>
				<footer>{{ randomQuote.author }}</footer>
			</blockquote>
		</section>
	</main>
</template>

<style scoped lang="scss">
@import "assets/style/global";

* {
	transition: background-color 300ms ease-in-out;
	transition-property: background-color, color;
}

.registration {
	display: grid;
	grid-template-columns: 1fr;
	height: 100dvh;
	max-height: 100vh;

	& section {
		height: 100dvh;
	}
}

.quotesBox {
	background-image: url("@/assets/images/backgrounds/DostoevskyPortret.jpg");
	background-size: cover;
	background-position: center;

	padding: 20px;

	display: none;
	align-items: end;

	.quotesBox__quote {
		background-color: $babyPink;

		padding: 10px;
		text-align: center;
		border-radius: 5px;

		&.dark {
			background-color: $blackOlive;
			color: $babyPink;
		}
	}
}

.form {
	display: flex;
	flex-direction: column;
	justify-content: space-between;
	align-items: center;

	padding: 10px;

	background-color: $babyPink;

	&.dark {
		background-color: $blackOlive;
	}

	.form__inputBox {
		display: flex;
		flex-direction: column;
		row-gap: 10px;

		width: 80%;
	}

	.form__input {
		color: $babyPink;

		&.dark {
			color: $blackOlive;
		}
	}

	.form__button {
		background-color: $blackOlive;
		color: $babyPink;

		border-radius: 5px;
		height: 45px;
		margin-top: 35px;

		&.dark {
			background-color: $babyPink;
			color: $blackOlive;
		}
	}

	.form__description {
		display: flex;
		justify-content: space-around;

		width: 100%;

		color: $blackOlive;

		&.dark {
			color: $babyPink;
		}
	}
}

@media screen and (min-width: $table) {
	.registration {
		grid-template-columns: 1fr 40%;
	}

	.quotesBox {
		display: flex;
	}
}
</style>